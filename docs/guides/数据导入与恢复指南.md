# 数据导入与恢复指南

## 概述

本指南详细介绍智能日历助手的数据导入与恢复功能，帮助用户在更换设备、浏览器或需要备份数据时，能够安全、完整地迁移所有个人数据。

---

## 一、支持的数据类型

### 1.1 可导出/导入的数据类型

| 数据类型 | 说明 | 存储位置 | 敏感级别 |
|---------|------|---------|---------|
| **日程事件** | 所有日历事件、提醒、任务 | `calendar_events` | 高 |
| **聊天记录** | 与AI助手的历史对话 | `chat_messages` | 中 |
| **应用设置** | 主题、字体、语言等偏好 | `app_settings` | 低 |
| **用户偏好** | AI偏好、隐私设置等 | `userPreferences` | 中 |
| **用户档案** | 个人信息、头像等 | `user_profile` | 高 |
| **天气设置** | 默认城市、常用城市列表 | `app_settings.weatherSettings` | 低 |
| **API密钥** | 加密的API访问密钥 | `app_settings.apiKeys` | 极高 |

### 1.2 数据格式说明

所有数据以 **JSON格式** 存储，采用标准的数据结构，便于阅读和编辑。

---

## 二、操作步骤

### 2.1 导出数据（备份）

#### 方法一：通过设置页面导出

1. **打开设置页面**
   - 点击左侧导航栏的"设置"图标
   - 或按快捷键 `Ctrl + ,`

2. **进入数据管理**
   - 在设置页面中找到"数据管理"选项卡
   - 点击"数据管理"进入数据操作界面

3. **选择导出内容**
   - 勾选需要导出的数据类型：
     - ☑️ 日程事件
     - ☑️ 聊天记录
     - ☑️ 应用设置
     - ☑️ 用户偏好
     - ☑️ 用户档案
   - 或点击"全选"导出所有数据

4. **设置导出选项**
   - **加密导出**：勾选后可设置密码保护（推荐）
   - **包含媒体文件**：是否导出上传的图片等
   - **压缩文件**：导出为ZIP压缩包（节省空间）

5. **执行导出**
   - 点击"导出数据"按钮
   - 选择保存位置
   - 等待导出完成

6. **验证导出文件**
   - 检查文件大小是否合理
   - 使用文本编辑器查看JSON结构是否完整

#### 方法二：通过快捷键快速导出

```
快捷键：Ctrl + Shift + E
```

- 直接导出全部数据（不含API密钥）
- 自动保存到下载文件夹
- 文件名格式：`calendar_backup_YYYYMMDD_HHMMSS.json`

### 2.2 导入数据（恢复）

#### 方法一：通过设置页面导入

1. **打开设置页面**
   - 点击左侧导航栏的"设置"图标

2. **进入数据管理**
   - 点击"数据管理"选项卡

3. **选择导入文件**
   - 点击"选择文件"按钮
   - 浏览并选择之前导出的 `.json` 或 `.zip` 文件
   - 支持拖拽文件到指定区域

4. **预览导入内容**
   - 系统自动解析文件并显示：
     - 数据版本信息
     - 包含的数据类型
     - 各类型数据数量
     - 导出时间戳

5. **选择导入模式**
   - **合并模式**（默认）：新数据与现有数据合并，冲突时保留较新数据
   - **覆盖模式**：完全替换现有数据，请谨慎使用

6. **数据验证**
   - 系统自动检查数据完整性
   - 显示验证结果：
     - ✅ 数据格式正确
     - ✅ 无损坏记录
     - ⚠️ 版本差异提示
     - ❌ 错误信息

7. **执行导入**
   - 确认无误后点击"开始导入"
   - 显示导入进度条
   - 等待导入完成

8. **重启应用**（如需要）
   - 某些设置更改需要刷新页面生效
   - 点击"立即重启"或手动刷新

#### 方法二：通过文件拖拽导入

1. 直接将备份文件拖拽到应用窗口
2. 自动弹出导入确认对话框
3. 确认后执行导入

---

## 三、支持的文件格式

### 3.1 标准JSON格式（.json）

```json
{
  "version": "1.0.0",
  "exportTime": "2026-01-31T10:30:00.000Z",
  "metadata": {
    "appVersion": "2.0.0",
    "exportType": "full",
    "dataTypes": ["events", "chat", "settings", "preferences", "profile"]
  },
  "data": {
    "events": [...],
    "chatMessages": [...],
    "settings": {...},
    "preferences": {...},
    "profile": {...}
  }
}
```

### 3.2 压缩格式（.zip）

包含以下文件：
- `data.json` - 主要数据文件
- `manifest.json` - 导出信息
- `media/` - 媒体文件目录（可选）

### 3.3 加密格式（.json.enc / .zip.enc）

- 使用AES-256加密
- 需要密码才能解密
- 文件名后缀标识加密状态

### 3.4 兼容性说明

| 版本 | 向后兼容 | 向前兼容 | 说明 |
|-----|---------|---------|------|
| v1.x → v2.x | ✅ | ⚠️ | 需要数据迁移 |
| v2.x → v2.x | ✅ | ✅ | 完全兼容 |
| v2.x → v1.x | ❌ | ❌ | 不支持 |

---

## 四、数据导入注意事项

### 4.1 导入前准备

1. **备份当前数据**
   - 导入前建议先导出当前数据作为备份
   - 防止导入失败导致数据丢失

2. **检查文件来源**
   - 确保文件来自可信来源
   - 避免导入恶意构造的数据文件

3. **确认存储空间**
   - 确保浏览器本地存储有足够空间
   - 建议预留至少 2 倍于导入文件大小的空间

### 4.2 导入过程中的注意事项

1. **不要关闭页面**
   - 导入过程中请勿刷新或关闭页面
   - 中断可能导致数据损坏

2. **网络连接**
   - 导入过程为本地操作，无需网络
   - 但建议保持连接以便获取帮助

3. **大文件处理**
   - 超过 5MB 的文件可能需要较长时间
   - 耐心等待，不要重复操作

### 4.3 数据冲突处理

当导入数据与现有数据存在冲突时：

| 冲突类型 | 合并模式处理 | 覆盖模式处理 |
|---------|------------|------------|
| 相同ID的事件 | 保留更新时间较晚的 | 使用导入数据 |
| 相同时间戳的消息 | 保留两条 | 使用导入数据 |
| 设置项 | 选择性合并 | 完全替换 |
| API密钥 | 保留现有（安全考虑） | 使用导入数据 |

### 4.4 安全注意事项

1. **API密钥保护**
   - 默认情况下，导入操作不会覆盖现有API密钥
   - 如需导入API密钥，请单独确认

2. **加密文件**
   - 加密文件需要正确密码才能导入
   - 密码错误超过5次将暂时锁定导入功能

3. **数据隐私**
   - 导入的数据仅存储在本地浏览器
   - 不会上传到任何服务器

---

## 五、成功恢复后的验证方法

### 5.1 自动验证

导入完成后，系统自动执行以下验证：

```
✅ 数据完整性检查 - 通过
✅ JSON格式验证 - 通过
✅ 数据类型匹配 - 通过
✅ 引用关系检查 - 通过
✅ 存储空间检查 - 通过
```

### 5.2 手动验证清单

#### 5.2.1 日程事件验证

- [ ] 打开日历视图，检查事件是否正确显示
- [ ] 点击具体日期，验证事件详情
- [ ] 检查事件数量是否与导入前一致
- [ ] 验证事件的提醒设置

#### 5.2.2 聊天记录验证

- [ ] 打开AI助手页面
- [ ] 检查历史对话列表
- [ ] 验证消息内容和时间戳
- [ ] 测试发送新消息是否正常

#### 5.2.3 设置验证

- [ ] 检查主题设置是否生效
- [ ] 验证字体大小和样式
- [ ] 确认语言设置
- [ ] 检查通知设置

#### 5.2.4 偏好设置验证

- [ ] 验证AI偏好设置
- [ ] 检查隐私设置
- [ ] 确认性能设置
- [ ] 验证无障碍设置

### 5.3 数据计数对比

导入前后对比各类型数据数量：

| 数据类型 | 导入前 | 导入后 | 状态 |
|---------|-------|-------|------|
| 日程事件 | 50 | 50 | ✅ 一致 |
| 聊天记录 | 120 | 120 | ✅ 一致 |
| 用户偏好 | 1 | 1 | ✅ 一致 |

### 5.4 功能测试

执行以下操作验证功能正常：

1. **创建新事件**
   - 点击"+"按钮创建新日程
   - 验证能否正常保存

2. **发送消息**
   - 向AI助手发送测试消息
   - 验证响应正常

3. **修改设置**
   - 更改主题或字体
   - 验证设置保存和生效

4. **刷新页面**
   - 按 F5 刷新
   - 验证数据持久化

### 5.5 问题排查

如果验证发现问题，请按以下步骤排查：

1. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 面板是否有错误信息

2. **验证LocalStorage**
   - 在 Application/Storage 面板查看
   - 确认数据已正确写入

3. **重新导入**
   - 清除现有数据后重新导入
   - 或尝试使用备份文件

4. **联系支持**
   - 如问题无法解决，请导出错误日志
   - 提供详细的操作步骤和错误信息

---

## 六、常见问题解答

### Q1: 导入后数据没有显示怎么办？

**可能原因和解决方案：**

1. **需要刷新页面**
   - 某些数据需要页面刷新才能加载
   - 按 F5 或 Ctrl+R 刷新

2. **数据格式不兼容**
   - 检查导出文件的版本号
   - 尝试使用兼容模式导入

3. **存储空间不足**
   - 清理浏览器缓存
   - 删除不必要的数据

### Q2: 可以导入其他日历应用的数据吗？

**支持的外部格式：**

- **iCalendar (.ics)** - 部分支持
- **CSV格式** - 需要转换
- **Google Calendar导出** - 需要转换

**转换工具：**
使用设置页面中的"数据转换"功能，可以将常见格式转换为系统支持的格式。

### Q3: 如何定期自动备份？

**设置自动备份：**

1. 进入设置 > 数据管理
2. 开启"自动备份"选项
3. 设置备份频率（每天/每周/每月）
4. 选择备份存储位置（本地/云存储）

### Q4: 导入的API密钥无法使用？

**安全机制说明：**

出于安全考虑，系统默认不会导入API密钥。如需导入：

1. 在导入设置中勾选"包含API密钥"
2. 输入加密密码（如文件已加密）
3. 单独确认导入API密钥

### Q5: 数据导入有大小限制吗？

**限制说明：**

- **单次导入限制**：50MB
- **存储总限制**：取决于浏览器（通常5-10MB）
- **事件数量**：无限制（但受存储空间限制）

**大文件处理建议：**

- 分批导出/导入
- 压缩媒体文件
- 清理历史数据

---

## 七、最佳实践建议

### 7.1 备份策略

1. **定期备份**
   - 建议每周进行一次完整备份
   - 重要操作前进行临时备份

2. **多地存储**
   - 本地备份 + 云存储
   - 避免单点故障

3. **版本管理**
   - 保留最近3个版本的备份
   - 命名包含日期：`backup_20260131_v1.json`

### 7.2 数据安全

1. **加密敏感数据**
   - 导出时启用加密
   - 使用强密码保护

2. **安全存储**
   - 不要将备份文件上传到公共云盘
   - 使用加密存储服务

3. **定期清理**
   - 删除旧的备份文件
   - 清理不再需要的聊天记录

### 7.3 迁移流程

**更换设备时的标准流程：**

1. 在旧设备上导出完整备份
2. 将备份文件安全传输到新设备
3. 在新设备上安装应用
4. 导入备份数据
5. 验证数据完整性
6. 删除旧设备上的敏感数据

---

## 八、技术细节

### 8.1 数据存储结构

```
LocalStorage
├── calendar_events      # 日程事件数组
├── chat_messages        # 聊天记录数组
├── chat_model          # 当前AI模型
├── app_settings        # 应用设置对象
├── userPreferences     # 用户偏好（加密）
└── user_profile        # 用户档案
```

### 8.2 导入导出API

```javascript
// 导出数据
const exporter = new DataExporter();
const backup = await exporter.export({
  types: ['events', 'chat', 'settings'],
  encrypt: true,
  password: 'your-password'
});

// 导入数据
const importer = new DataImporter();
const result = await importer.import(file, {
  mode: 'merge', // 或 'overwrite'
  validate: true
});
```

### 8.3 错误代码说明

| 错误代码 | 说明 | 解决方案 |
|---------|------|---------|
| IMP001 | 文件格式错误 | 检查文件是否为有效JSON |
| IMP002 | 数据版本不兼容 | 使用数据转换工具 |
| IMP003 | 存储空间不足 | 清理浏览器数据 |
| IMP004 | 密码错误 | 确认密码正确 |
| IMP005 | 数据损坏 | 使用备份文件 |

---

## 九、联系支持

如遇到问题或需要帮助：

1. **查看日志**
   - F12 打开开发者工具
   - 导出 Console 日志

2. **提交反馈**
   - 设置 > 关于 > 反馈
   - 附上错误日志和备份文件（脱敏后）

3. **社区支持**
   - 访问官方论坛
   - 查看常见问题解答

---

**文档版本**：v1.0.0  
**最后更新**：2026-01-31  
**适用版本**：智能日历助手 v2.0.0+
