# 系统现状文档

**文档版本**: 1.0  
**创建日期**: 2026-01-31  
**最后更新**: 2026-01-31  

---

## 1. 系统概述

### 1.1 项目简介
智能日历助手是一个基于Vue 3的现代化日历应用，集成了AI助手功能，支持多平台AI模型接入，提供日程管理、天气查询、智能提醒等功能。

### 1.2 技术栈

| 层级 | 技术 |
|------|------|
| 前端框架 | Vue 3 + Composition API |
| 状态管理 | Pinia |
| UI组件库 | Element Plus |
| 样式 | Tailwind CSS |
| 构建工具 | Vite |
| 路由 | Vue Router |

---

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────┐
│                        前端应用层                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │  AI助手模块  │ │  日历模块   │ │  设置模块   │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
├─────────────────────────────────────────────────────────────┤
│                        业务服务层                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │ ChatService │ │ EventStore  │ │ WeatherSvc  │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
├─────────────────────────────────────────────────────────────┤
│                        API客户端层                           │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │OpenRouter   │ │   Cherry    │ │   QiniuAI   │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
├─────────────────────────────────────────────────────────────┤
│                        数据存储层                            │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐           │
│  │ localStorage│ │  ChatStorage│ │  VersionMgr │           │
│  └─────────────┘ └─────────────┘ └─────────────┘           │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 模块依赖关系

```
AIAssistant.vue
    ├── ChatService.js
    │   ├── OpenRouterClient.js
    │   ├── CherryApiClient.js
    │   ├── OllamaClient.js
    │   ├── QiniuAIClient.js
    │   ├── RequestBuilder.js
    │   ├── ResponseParser.js
    │   └── ChatStorage.js
    ├── useChatStore (Pinia)
    └── useSettingsStore (Pinia)

Calendar.vue
    ├── useEventsStore (Pinia)
    ├── ReminderManager.vue
    └── ModernCard.vue
```

---

## 3. 功能清单

### 3.1 AI助手模块

| 功能ID | 功能名称 | 状态 | 描述 |
|--------|----------|------|------|
| AI-001 | 多提供商聊天 | 运行中 | 支持OpenRouter、Cherry、七牛云、Ollama |
| AI-002 | API密钥管理 | 运行中 | 配置和验证各平台API密钥 |
| AI-003 | 模型切换 | 运行中 | 动态切换AI模型 |
| AI-004 | 连接状态监控 | 运行中 | 实时显示连接状态 |
| AI-005 | 快捷操作 | 运行中 | 预设快捷对话模板 |
| AI-006 | 对话历史 | 运行中 | 保存和查看历史对话 |
| AI-007 | 消息关键信息提取 | 运行中 | 提取事件、日期、时间信息 |

### 3.2 日历模块

| 功能ID | 功能名称 | 状态 | 描述 |
|--------|----------|------|------|
| CAL-001 | 月视图 | 运行中 | 显示整月日历 |
| CAL-002 | 周视图 | 运行中 | 显示一周日程 |
| CAL-003 | 日视图 | 运行中 | 显示单日详情 |
| CAL-004 | 事件创建 | 运行中 | 手动创建事件 |
| CAL-005 | 事件编辑 | 运行中 | 修改事件信息 |
| CAL-006 | 事件删除 | 运行中 | 删除事件 |
| CAL-007 | 事件筛选 | 运行中 | 按类型、优先级筛选 |
| CAL-008 | 搜索功能 | 运行中 | 搜索事件 |
| CAL-009 | 提醒管理 | 运行中 | 设置事件提醒 |

### 3.3 设置模块

| 功能ID | 功能名称 | 状态 | 描述 |
|--------|----------|------|------|
| SET-001 | API提供商配置 | 运行中 | 选择和配置AI提供商 |
| SET-002 | 模型配置 | 运行中 | 选择和配置模型 |
| SET-003 | 界面设置 | 运行中 | 主题、语言等 |
| SET-004 | 通知设置 | 运行中 | 提醒通知配置 |
| SET-005 | 数据管理 | 运行中 | 导入导出、清理 |

### 3.4 用户模块

| 功能ID | 功能名称 | 状态 | 描述 |
|--------|----------|------|------|
| USR-001 | 用户资料 | 运行中 | 管理用户信息 |
| USR-002 | 头像设置 | 运行中 | 上传和裁剪头像 |
| USR-003 | 偏好设置 | 运行中 | 个人偏好配置 |

### 3.5 天气模块

| 功能ID | 功能名称 | 状态 | 描述 |
|--------|----------|------|------|
| WEA-001 | 天气查询 | 运行中 | 查询当前天气 |
| WEA-002 | 天气预报 | 运行中 | 显示未来天气 |
| WEA-003 | 位置管理 | 运行中 | 管理多个位置 |

---

## 4. 数据模型

### 4.1 事件数据模型

```typescript
interface CalendarEvent {
  id: number;              // 事件ID
  title: string;           // 标题
  startDate: string;       // 开始时间 (ISO 8601)
  endDate: string;         // 结束时间 (ISO 8601)
  type: string;            // 类型 (meeting/appointment/reminder/task)
  priority: string;        // 优先级 (high/medium/low)
  location?: string;       // 地点
  description?: string;    // 描述
  attendees?: string[];    // 参与人
  reminder?: number;       // 提前提醒时间（分钟）
  createdAt: string;       // 创建时间
  updatedAt: string;       // 更新时间
}
```

### 4.2 聊天消息数据模型

```typescript
interface ChatMessage {
  id: number;              // 消息ID
  role: 'user' | 'assistant'; // 角色
  content: string;         // 内容
  keyInfo?: {              // 关键信息
    events?: string[];
    dates?: string[];
    times?: string[];
    priorities?: string[];
  };
  timestamp: string;       // 时间戳
}
```

### 4.3 用户设置数据模型

```typescript
interface UserSettings {
  apiProvider: string;     // API提供商
  apiKeys: {               // API密钥
    openrouter?: string;
    cherry?: string;
    qiniu?: string;
  };
  currentModel: string;    // 当前模型
  theme: string;           // 主题
  language: string;        // 语言
  notifications: boolean;  // 通知开关
}
```

---

## 5. 接口清单

### 5.1 内部接口

#### 5.1.1 事件管理接口

```javascript
// 添加事件
addEvent(eventData: CalendarEvent): void

// 更新事件
updateEvent(eventId: number, eventData: Partial<CalendarEvent>): void

// 删除事件
deleteEvent(eventId: number): void

// 获取日期事件
getEventsByDate(date: string): CalendarEvent[]
```

#### 5.1.2 聊天服务接口

```javascript
// 发送消息
sendMessage(userInput: string, options?: object): Promise<ChatResult>

// 获取历史
getChatHistory(limit?: number): Promise<ChatMessage[]>

// 清空历史
clearChatHistory(): Promise<void>
```

### 5.2 外部API接口

#### 5.2.1 OpenRouter API

```
Endpoint: https://openrouter.ai/api/v1/chat/completions
Method: POST
Headers:
  - Authorization: Bearer {apiKey}
  - HTTP-Referer: {siteUrl}
  - X-Title: {appName}
```

#### 5.2.2 Cherry API

```
Endpoint: https://api.cherry.ai/v1/chat/completions
Method: POST
Headers:
  - Authorization: Bearer {apiKey}
```

#### 5.2.3 七牛云AI API

```
Endpoint: https://ai.qiniu.com/v1/chat/completions
Method: POST
Headers:
  - Authorization: Bearer {apiKey}
```

---

## 6. 存储方案

### 6.1 localStorage存储项

| Key | 内容 | 大小限制 |
|-----|------|----------|
| calendar_events | 日历事件数据 | ~5MB |
| chat_messages | 聊天记录 | ~5MB |
| settings | 用户设置 | ~100KB |
| user_profile | 用户资料 | ~100KB |
| api_keys | API密钥（加密） | ~10KB |

### 6.2 存储管理策略

- 自动清理过期数据
- 容量监控和警告
- 数据压缩存储
- 版本迁移支持

---

## 7. 关键业务流程

### 7.1 创建事件流程

```
用户操作
    ↓
填写事件表单
    ↓
验证数据
    ↓
调用 addEvent()
    ↓
保存到内存
    ↓
持久化到 localStorage
    ↓
更新UI显示
```

### 7.2 AI聊天流程

```
用户输入消息
    ↓
调用 ChatService.sendMessage()
    ↓
构建请求 (RequestBuilder)
    ↓
调用AI API
    ↓
解析响应 (ResponseParser)
    ↓
提取关键信息
    ↓
显示AI回复
    ↓
保存到存储
```

---

## 8. 技术债务

| ID | 描述 | 影响 | 建议处理时间 |
|----|------|------|-------------|
| TD-001 | 部分组件缺少单元测试 | 维护困难 | 下一个迭代 |
| TD-002 | API错误处理不够统一 | 用户体验不一致 | 下一个迭代 |
| TD-003 | 部分工具函数重复 | 代码冗余 | 重构时处理 |

---

## 9. 附录

### 9.1 参考文档
- [项目README](../README.md)
- [API密钥管理文档](../API密钥管理文档.md)
- [开发流程文档](../开发流程文档.md)

### 9.2 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2026-01-31 | 初始版本 | AI助手 |

