# 技术方案文档：农历日期显示与节假日标记功能

## 文档信息

| 项目 | 内容 |
|------|------|
| **版本** | v1.0.0 |
| **生效日期** | 2026-02-17 |
| **维护者** | AI助手 |
| **状态** | 设计完成，待实施 |

---

## 1. 需求概述

### 1.1 功能目标

为日历组件添加以下功能：
1. 农历日期显示（格式：正月、二月...腊月，初一、初二...三十）
2. 节假日视觉标记（彩色背景高亮）
3. 节假日名称显示
4. 性能优化（避免重复计算）

### 1.2 约束条件

- 保持主题色彩一致
- 支持所有传统节日
- 在不同屏幕尺寸下显示效果一致

---

## 2. 现有资产分析

### 2.1 已有文件

项目中已存在完整的农历日历工具：`src/utils/lunarCalendar.js`

**功能包括：**
- ✅ 公历转农历算法（1900-2100年）
- ✅ 基础节假日数据（法定假日+部分传统节日）
- ✅ 黄历宜忌功能
- ✅ 天干地支、生肖计算

---

## 3. 设计方案

### 3.1 农历日期显示

**显示格式：**
- 月份：正月、二月、三月...冬月、腊月
- 日期：初一、初二...三十
- 闰月标记：闰四月
- 显示位置：公历日期下方，字号稍小

### 3.2 节假日标记（方案A）

**视觉效果：**
- 法定节假日：蓝色浅背景（rgba(59, 130, 246, 0.1)）
- 传统节日：红色/橙色浅背景（rgba(239, 68, 68, 0.1)）
- 节日名称显示在日期上方

### 3.3 性能优化（方案A）

**缓存机制：**
- 使用Map缓存已计算的农历日期和节假日信息
- 缓存键格式：`YYYY-MM-DD`
- 避免重复计算同一日期

---

## 4. 详细设计

### 4.1 文件结构

```
src/
├── utils/
│   └── lunarCalendar.js  (扩展)
└── views/
    └── Calendar.vue       (修改)
```

### 4.2 lunarCalendar.js 扩展

**新增功能：**
1. 扩展 `lunarHolidays` 对象，添加更多传统节日
2. 添加缓存机制 `_cache` Map
3. 修改 `getCalendarInfo` 方法，支持缓存

**新增节假日：**
- 龙抬头（二月二）
- 寒食节（清明节前一天）
- 七夕节（七月初七）
- 中元节（七月十五）
- 寒衣节（十月初一）
- 小年（腊月二十三）
- 除夕（腊月三十）

### 4.3 Calendar.vue 修改

**修改内容：**
1. 导入 `lunarCalendar` 工具
2. 在 `calendarDays` 计算属性中添加农历和节假日信息
3. 在模板中显示农历日期
4. 在模板中显示节假日标记
5. 添加相应的样式

---

## 5. 实施计划

### 任务清单

1. **扩展 lunarCalendar.js**
   - 添加更多传统节日数据
   - 添加缓存机制
   - 测试农历转换准确性

2. **修改 Calendar.vue**
   - 集成农历工具
   - 添加农历日期显示
   - 添加节假日标记样式
   - 实现响应式布局

3. **测试验证**
   - 测试不同年份的农历显示
   - 测试节假日标记
   - 测试响应式效果
   - 性能测试

---

## 6. 验收标准

- [ ] 农历日期显示格式正确（正月、初一）
- [ ] 所有传统节日都有标记
- [ ] 节假日视觉效果符合方案A
- [ ] 性能优化生效（无重复计算）
- [ ] 在不同屏幕尺寸下显示正常
- [ ] 主题色彩保持一致

---

## 7. 风险与注意事项

### 7.1 风险点

1. **农历算法准确性**：需验证1900-2100年范围内的转换准确性
2. **性能**：大量日期计算可能影响性能，需确保缓存机制有效
3. **响应式**：小屏幕下农历日期和节假日名称可能显示不全

### 7.2 注意事项

- 保持与现有代码风格一致
- 添加必要的中文注释
- 避免不必要的对象创建
- 确保函数参数传递一致

---

## 8. 更新记录

| 日期 | 版本 | 修改内容 | 作者 |
|------|------|----------|------|
| 2026-02-17 | v1.0.0 | 初始版本 | AI助手 |

