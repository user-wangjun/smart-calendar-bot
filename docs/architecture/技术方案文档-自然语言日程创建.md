# æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£ - è‡ªç„¶è¯­è¨€æ—¥ç¨‹åˆ›å»ºåŠŸèƒ½

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-31  
**æœ€åæ›´æ–°**: 2026-01-31  
**çŠ¶æ€**: è‰ç¨¿  

---

## 1. æ–¹æ¡ˆæ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡
å®ç°ä¸€ä¸ªæ··åˆæ–¹æ¡ˆï¼Œç»“åˆè§„åˆ™å¼•æ“å’ŒAIè§£æï¼Œç¡®ä¿é«˜å‡†ç¡®ç‡çš„åŒæ—¶æ§åˆ¶æˆæœ¬å’Œå¤æ‚åº¦ã€‚

### 1.2 æ ¸å¿ƒè®¾è®¡åŸåˆ™
- **æ¨¡å—åŒ–**: å„åŠŸèƒ½æ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤å’Œæ‰©å±•
- **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½å’Œæ•°æ®
- **æ¸è¿›å¼**: æ”¯æŒåŠŸèƒ½é€æ­¥å¢å¼º
- **å¯æµ‹è¯•**: æ¯ä¸ªæ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•

---

## 2. æ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·ç•Œé¢å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              AIAssistant.vue (èŠå¤©ç•Œé¢)                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚  èŠå¤©è¾“å…¥æ¡†  â”‚  â”‚ æ¶ˆæ¯å±•ç¤ºåŒºåŸŸ â”‚  â”‚ ç¡®è®¤å¡ç‰‡ç»„ä»¶ â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ä¸šåŠ¡é€»è¾‘å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              NaturalLanguageService                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ æ„å›¾è¯†åˆ«å™¨   â”‚  â”‚ å®ä½“æå–å™¨   â”‚  â”‚ æ—¶é—´è§£æå™¨   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚(IntentRecog)â”‚  â”‚(EntityExtr) â”‚  â”‚(TimeParser) â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ•°æ®è®¿é—®å±‚                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚ useChatStoreâ”‚  â”‚useEventsStoreâ”‚  â”‚  ChatServiceâ”‚             â”‚
â”‚  â”‚  (Pinia)    â”‚  â”‚   (Pinia)   â”‚  â”‚             â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¨¡å—è¯¦ç»†è®¾è®¡

#### 2.2.1 æ„å›¾è¯†åˆ«æ¨¡å— (IntentRecognizer)

**èŒè´£**: åˆ¤æ–­ç”¨æˆ·è¾“å…¥æ˜¯å¦ä¸ºåˆ›å»ºæ—¥ç¨‹çš„æ„å›¾

**å®ç°æ–¹å¼**: è§„åˆ™ + AIæ··åˆ

```javascript
// ç¬¬ä¸€é˜¶æ®µï¼šè§„åˆ™å¿«é€ŸåŒ¹é…
const INTENT_PATTERNS = {
  CREATE_EVENT: [
    /(?:åˆ›å»º|æ·»åŠ |å®‰æ’|è®¾ç½®|é¢„çº¦|æ–°å»º).{0,5}(?:æ—¥ç¨‹|äº‹ä»¶|ä¼šè®®|æé†’|ä»»åŠ¡|çº¦ä¼š)/i,
    /(?:æ˜å¤©|åå¤©|ä¸‹å‘¨|ä»Šå¤©).{0,10}(?:æœ‰|è¦|éœ€è¦|å‡†å¤‡).{0,5}(?:ä¼š|åš|å»)/i,
    /(?:è®°å¾—|æé†’|åˆ«å¿˜äº†).{0,10}(?:æ˜å¤©|åå¤©|ä¸‹å‘¨)/i,
  ],
  QUERY_SCHEDULE: [
    /(?:æŸ¥çœ‹|æŸ¥è¯¢|çœ‹çœ‹).{0,5}(?:æ—¥ç¨‹|å®‰æ’|è®¡åˆ’|æœ‰ä»€ä¹ˆ)/i,
    /(?:æ˜å¤©|åå¤©|ä¸‹å‘¨).{0,5}(?:æœ‰ä»€ä¹ˆ|å¹²ä»€ä¹ˆ|å®‰æ’)/i,
  ],
  MODIFY_EVENT: [
    /(?:ä¿®æ”¹|æ›´æ”¹|è°ƒæ•´|åˆ é™¤|å–æ¶ˆ).{0,5}(?:æ—¥ç¨‹|äº‹ä»¶|ä¼šè®®)/i,
  ],
};

// ç¬¬äºŒé˜¶æ®µï¼šAIç¡®è®¤ï¼ˆå½“è§„åˆ™åŒ¹é…ä¸ç¡®å®šæ—¶ï¼‰
async function recognizeIntentWithAI(text) {
  const prompt = `
åˆ†æç”¨æˆ·è¾“å…¥çš„æ„å›¾ï¼Œåªèƒ½æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼šcreate_event, query_schedule, modify_event, chat

ç”¨æˆ·è¾“å…¥ï¼š"${text}"

åªè¿”å›æ„å›¾æ ‡è¯†ç¬¦ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
`;
  // è°ƒç”¨AI API
  const response = await chatService.sendMessage(prompt, { stream: false });
  return response.content.trim();
}
```

#### 2.2.2 å®ä½“æå–æ¨¡å— (EntityExtractor)

**èŒè´£**: ä»æ–‡æœ¬ä¸­æå–æ—¶é—´ã€åœ°ç‚¹ã€äººç‰©ã€äº‹ä»¶æ ‡é¢˜ç­‰ä¿¡æ¯

**å®ç°æ–¹å¼**: è§„åˆ™å¼•æ“ä¸ºä¸»ï¼ŒAIå¢å¼ºä¸ºè¾…

```javascript
class EntityExtractor {
  constructor() {
    this.patterns = {
      // æ—¶é—´æ¨¡å¼
      time: {
        absolute: /(\d{4}å¹´)?(\d{1,2}æœˆ)(\d{1,2}æ—¥)?[\s,ï¼Œ]*(\d{1,2})[:ï¼šç‚¹](\d{0,2})?/,
        relative: /(ä»Šå¤©|æ˜å¤©|åå¤©|å¤§åå¤©|æœ¬å‘¨|ä¸‹å‘¨|ä¸‹ä¸‹å‘¨)/,
        weekday: /(å‘¨ä¸€|å‘¨äºŒ|å‘¨ä¸‰|å‘¨å››|å‘¨äº”|å‘¨å…­|å‘¨æ—¥|æ˜ŸæœŸ[ä¸€äºŒä¸‰å››äº”å…­æ—¥])/,
        dayTime: /(æ—©ä¸Š|ä¸Šåˆ|ä¸­åˆ|ä¸‹åˆ|æ™šä¸Š|å‡Œæ™¨)(\d{1,2})?[:ï¼šç‚¹]?(\d{0,2})?/,
        duration: /(\d+)[\s]*(?:ä¸ª)?(å°æ—¶|åˆ†é’Ÿ|åˆ†|å¤©|å‘¨)/,
        recurrence: /(æ¯å¤©|æ¯å‘¨|æ¯æœˆ|æ¯ä¸ªå·¥ä½œæ—¥|æ¯ä¸ªå‘¨æœ«)/,
      },
      // åœ°ç‚¹æ¨¡å¼
      location: /(?:åœ¨|å»|åˆ°|ä½äº)[\s]*([^ï¼Œã€‚,]+?)(?:å’Œ|ä¸|è·Ÿ|è§é¢|å¼€ä¼š|åƒé¥­|ç­‰|$)/,
      // äººç‰©æ¨¡å¼
      person: /(?:å’Œ|ä¸|è·Ÿ|åŒ)[\s]*([^ï¼Œã€‚,]+?)(?:ä¸€èµ·|è§é¢|å¼€ä¼š|åƒé¥­|ç­‰|$)/,
      // äº‹ä»¶ç±»å‹
      eventType: /(ä¼šè®®|çº¦ä¼š|ä»»åŠ¡|æé†’|ç”Ÿæ—¥|çºªå¿µæ—¥|èšé¤|é¢è¯•|çº¦ä¼š|è¿åŠ¨|çœ‹ç—…|è´­ç‰©)/,
    };
  }

  /**
   * æå–æ‰€æœ‰å®ä½“
   */
  extract(text) {
    const entities = {
      time: this.extractTime(text),
      location: this.extractLocation(text),
      attendees: this.extractAttendees(text),
      eventType: this.extractEventType(text),
      title: this.extractTitle(text),
    };
    return entities;
  }

  /**
   * æå–æ—¶é—´ä¿¡æ¯
   */
  extractTime(text) {
    const timeInfo = {
      startTime: null,
      endTime: null,
      isAllDay: false,
      recurrence: null,
    };

    // è§£æç›¸å¯¹æ—¶é—´
    const relativeMatch = text.match(this.patterns.time.relative);
    if (relativeMatch) {
      timeInfo.startTime = this.parseRelativeTime(relativeMatch[1]);
    }

    // è§£æç»å¯¹æ—¶é—´
    const absoluteMatch = text.match(this.patterns.time.absolute);
    if (absoluteMatch) {
      timeInfo.startTime = this.parseAbsoluteTime(absoluteMatch);
    }

    // è§£ææ—¶é—´æ®µ
    const durationMatch = text.match(this.patterns.time.duration);
    if (durationMatch && timeInfo.startTime) {
      timeInfo.endTime = this.calculateEndTime(
        timeInfo.startTime,
        parseInt(durationMatch[1]),
        durationMatch[2]
      );
    }

    // è§£æé‡å¤è§„åˆ™
    const recurrenceMatch = text.match(this.patterns.time.recurrence);
    if (recurrenceMatch) {
      timeInfo.recurrence = this.parseRecurrence(recurrenceMatch[1]);
    }

    return timeInfo;
  }

  /**
   * è§£æç›¸å¯¹æ—¶é—´
   */
  parseRelativeTime(relativeText) {
    const now = new Date();
    const result = new Date(now);

    switch (relativeText) {
      case 'ä»Šå¤©':
        break;
      case 'æ˜å¤©':
        result.setDate(result.getDate() + 1);
        break;
      case 'åå¤©':
        result.setDate(result.getDate() + 2);
        break;
      case 'å¤§åå¤©':
        result.setDate(result.getDate() + 3);
        break;
      case 'æœ¬å‘¨':
        // ä¿æŒæœ¬å‘¨
        break;
      case 'ä¸‹å‘¨':
        result.setDate(result.getDate() + 7);
        break;
      case 'ä¸‹ä¸‹å‘¨':
        result.setDate(result.getDate() + 14);
        break;
    }

    return result;
  }

  /**
   * è§£æé‡å¤è§„åˆ™
   */
  parseRecurrence(recurrenceText) {
    const recurrenceMap = {
      'æ¯å¤©': { frequency: 'daily', interval: 1 },
      'æ¯å‘¨': { frequency: 'weekly', interval: 1 },
      'æ¯æœˆ': { frequency: 'monthly', interval: 1 },
      'æ¯ä¸ªå·¥ä½œæ—¥': { frequency: 'weekly', interval: 1, days: [1, 2, 3, 4, 5] },
      'æ¯ä¸ªå‘¨æœ«': { frequency: 'weekly', interval: 1, days: [0, 6] },
    };
    return recurrenceMap[recurrenceText] || null;
  }
}
```

#### 2.2.3 æ—¶é—´è§£ææ¨¡å— (TimeParser)

**èŒè´£**: ä¸“é—¨å¤„ç†æ—¶é—´ç›¸å…³çš„è§£æå’Œè®¡ç®—

```javascript
class TimeParser {
  /**
   * è§£æä¸­æ–‡æ—¶é—´è¡¨è¾¾
   */
  parseChineseTime(text, referenceDate = new Date()) {
    const result = {
      startTime: null,
      endTime: null,
      isAllDay: false,
      confidence: 0,
    };

    // æå–æ—¥æœŸéƒ¨åˆ†
    const dateInfo = this.extractDate(text, referenceDate);
    // æå–æ—¶é—´éƒ¨åˆ†
    const timeInfo = this.extractTimeOfDay(text);

    // ç»„åˆæ—¥æœŸå’Œæ—¶é—´
    if (dateInfo.date) {
      result.startTime = this.combineDateTime(dateInfo.date, timeInfo.time);
      result.confidence = (dateInfo.confidence + timeInfo.confidence) / 2;
    }

    // è®¡ç®—ç»“æŸæ—¶é—´ï¼ˆé»˜è®¤1å°æ—¶ï¼‰
    if (result.startTime && !result.endTime) {
      result.endTime = new Date(result.startTime.getTime() + 60 * 60 * 1000);
    }

    return result;
  }

  /**
   * æå–æ—¥æœŸ
   */
  extractDate(text, referenceDate) {
    // å®ç°æ—¥æœŸæå–é€»è¾‘
    // ...
  }

  /**
   * æå–æ—¶é—´
   */
  extractTimeOfDay(text) {
    const timeKeywords = {
      'æ—©ä¸Š': { hour: 8, minute: 0 },
      'ä¸Šåˆ': { hour: 9, minute: 0 },
      'ä¸­åˆ': { hour: 12, minute: 0 },
      'ä¸‹åˆ': { hour: 14, minute: 0 },
      'æ™šä¸Š': { hour: 19, minute: 0 },
      'å‡Œæ™¨': { hour: 6, minute: 0 },
    };

    for (const [keyword, time] of Object.entries(timeKeywords)) {
      if (text.includes(keyword)) {
        return { time, confidence: 0.8 };
      }
    }

    // å°è¯•åŒ¹é…å…·ä½“æ—¶é—´
    const timeMatch = text.match(/(\d{1,2})[:ï¼šç‚¹](\d{0,2})/);
    if (timeMatch) {
      return {
        time: {
          hour: parseInt(timeMatch[1]),
          minute: parseInt(timeMatch[2]) || 0,
        },
        confidence: 0.9,
      };
    }

    return { time: null, confidence: 0 };
  }
}
```

#### 2.2.4 ä¸»æœåŠ¡æ¨¡å— (NaturalLanguageService)

**èŒè´£**: æ•´åˆå„æ¨¡å—ï¼Œæä¾›ç»Ÿä¸€çš„è§£ææ¥å£

```javascript
class NaturalLanguageService {
  constructor() {
    this.intentRecognizer = new IntentRecognizer();
    this.entityExtractor = new EntityExtractor();
    this.timeParser = new TimeParser();
  }

  /**
   * è§£æè‡ªç„¶è¯­è¨€è¾“å…¥
   */
  async parse(input, context = {}) {
    const result = {
      intent: null,
      event: null,
      confidence: 0,
      missingInfo: [],
      rawInput: input,
    };

    try {
      // 1. æ„å›¾è¯†åˆ«
      result.intent = await this.intentRecognizer.recognize(input);

      if (result.intent !== 'create_event') {
        return result;
      }

      // 2. å®ä½“æå–
      const entities = this.entityExtractor.extract(input);

      // 3. æ—¶é—´è§£æ
      const timeInfo = this.timeParser.parseChineseTime(
        input,
        context.currentTime || new Date()
      );

      // 4. æ„å»ºäº‹ä»¶å¯¹è±¡
      result.event = this.buildEventObject(entities, timeInfo, input);

      // 5. è®¡ç®—ç½®ä¿¡åº¦
      result.confidence = this.calculateConfidence(entities, timeInfo);

      // 6. æ£€æŸ¥ç¼ºå¤±ä¿¡æ¯
      result.missingInfo = this.checkMissingInfo(result.event);

    } catch (error) {
      console.error('è§£æå¤±è´¥:', error);
      result.error = error.message;
    }

    return result;
  }

  /**
   * æ„å»ºäº‹ä»¶å¯¹è±¡
   */
  buildEventObject(entities, timeInfo, originalText) {
    return {
      title: entities.title || this.generateDefaultTitle(entities, originalText),
      startTime: timeInfo.startTime?.toISOString(),
      endTime: timeInfo.endTime?.toISOString(),
      location: entities.location,
      attendees: entities.attendees,
      description: originalText,
      recurrence: timeInfo.recurrence,
    };
  }

  /**
   * ç”Ÿæˆé»˜è®¤æ ‡é¢˜
   */
  generateDefaultTitle(entities, originalText) {
    if (entities.eventType) {
      return entities.eventType;
    }
    // ä»åŸæ–‡ä¸­æå–å‰10ä¸ªå­—ç¬¦ä½œä¸ºæ ‡é¢˜
    return originalText.substring(0, 10) + '...';
  }

  /**
   * è®¡ç®—ç½®ä¿¡åº¦
   */
  calculateConfidence(entities, timeInfo) {
    let score = 0;
    let total = 0;

    // æ—¶é—´è§£æç½®ä¿¡åº¦æƒé‡æœ€é«˜
    if (timeInfo.startTime) {
      score += timeInfo.confidence * 0.5;
    }
    total += 0.5;

    // æ ‡é¢˜
    if (entities.title || entities.eventType) {
      score += 0.3;
    }
    total += 0.3;

    // å…¶ä»–ä¿¡æ¯
    if (entities.location) score += 0.1;
    if (entities.attendees) score += 0.1;
    total += 0.2;

    return score / total;
  }

  /**
   * æ£€æŸ¥ç¼ºå¤±ä¿¡æ¯
   */
  checkMissingInfo(event) {
    const missing = [];

    if (!event.title) {
      missing.push('äº‹ä»¶æ ‡é¢˜');
    }
    if (!event.startTime) {
      missing.push('å¼€å§‹æ—¶é—´');
    }

    return missing;
  }
}
```

---

## 3. ç•Œé¢è®¾è®¡

### 3.1 äº‹ä»¶ç¡®è®¤å¡ç‰‡ç»„ä»¶

```vue
<template>
  <div class="event-confirm-card" v-if="parsedEvent">
    <div class="card-header">
      <span class="card-icon">ğŸ“…</span>
      <span class="card-title">åˆ›å»ºæ–°äº‹ä»¶</span>
      <span class="confidence-badge" :class="confidenceClass">
        {{ confidenceText }}
      </span>
    </div>

    <div class="card-body">
      <!-- äº‹ä»¶æ ‡é¢˜ -->
      <div class="field-group">
        <label class="field-label">æ ‡é¢˜</label>
        <div class="field-value">
          <input
            v-model="editableEvent.title"
            type="text"
            class="field-input"
            placeholder="è¾“å…¥äº‹ä»¶æ ‡é¢˜"
          />
        </div>
      </div>

      <!-- æ—¶é—´ -->
      <div class="field-group">
        <label class="field-label">æ—¶é—´</label>
        <div class="field-value">
          <span class="time-display">{{ formatTimeRange(editableEvent) }}</span>
          <button class="edit-btn" @click="showTimePicker = true">
            ä¿®æ”¹
          </button>
        </div>
      </div>

      <!-- åœ°ç‚¹ -->
      <div class="field-group">
        <label class="field-label">åœ°ç‚¹</label>
        <div class="field-value">
          <input
            v-model="editableEvent.location"
            type="text"
            class="field-input"
            placeholder="æ·»åŠ åœ°ç‚¹"
          />
        </div>
      </div>

      <!-- å‚ä¸äºº -->
      <div class="field-group">
        <label class="field-label">å‚ä¸äºº</label>
        <div class="field-value">
          <input
            v-model="attendeesText"
            type="text"
            class="field-input"
            placeholder="æ·»åŠ å‚ä¸äººï¼Œç”¨é€—å·åˆ†éš”"
          />
        </div>
      </div>

      <!-- é‡å¤ -->
      <div class="field-group">
        <label class="field-label">é‡å¤</label>
        <div class="field-value">
          <select v-model="editableEvent.recurrence" class="field-select">
            <option :value="null">ä¸é‡å¤</option>
            <option value="daily">æ¯å¤©</option>
            <option value="weekly">æ¯å‘¨</option>
            <option value="monthly">æ¯æœˆ</option>
          </select>
        </div>
      </div>

      <!-- ç¼ºå¤±ä¿¡æ¯æç¤º -->
      <div v-if="missingInfo.length > 0" class="missing-info">
        <span class="warning-icon">âš ï¸</span>
        <span>è¯·è¡¥å……ï¼š{{ missingInfo.join('ã€') }}</span>
      </div>
    </div>

    <div class="card-footer">
      <button class="btn-confirm" @click="confirmCreate" :disabled="!canConfirm">
        âœ“ ç¡®è®¤åˆ›å»º
      </button>
      <button class="btn-cancel" @click="cancel">
        âœ• å–æ¶ˆ
      </button>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, watch } from 'vue';

const props = defineProps({
  parsedEvent: {
    type: Object,
    required: true,
  },
});

const emit = defineEmits(['confirm', 'cancel']);

// å¯ç¼–è¾‘çš„äº‹ä»¶æ•°æ®
const editableEvent = ref({ ...props.parsedEvent });

// å‚ä¸äººæ–‡æœ¬
const attendeesText = ref(
  props.parsedEvent.attendees?.join('ã€') || ''
);

// ç½®ä¿¡åº¦ç›¸å…³
const confidenceClass = computed(() => {
  if (props.parsedEvent.confidence >= 0.8) return 'high';
  if (props.parsedEvent.confidence >= 0.5) return 'medium';
  return 'low';
});

const confidenceText = computed(() => {
  if (props.parsedEvent.confidence >= 0.8) return 'é«˜ç½®ä¿¡åº¦';
  if (props.parsedEvent.confidence >= 0.5) return 'ä¸­ç½®ä¿¡åº¦';
  return 'ä½ç½®ä¿¡åº¦';
});

// ç¼ºå¤±ä¿¡æ¯
const missingInfo = computed(() => {
  const missing = [];
  if (!editableEvent.value.title) missing.push('äº‹ä»¶æ ‡é¢˜');
  if (!editableEvent.value.startTime) missing.push('å¼€å§‹æ—¶é—´');
  return missing;
});

// æ˜¯å¦å¯ä»¥ç¡®è®¤
const canConfirm = computed(() => {
  return missingInfo.value.length === 0;
});

// æ ¼å¼åŒ–æ—¶é—´èŒƒå›´
function formatTimeRange(event) {
  if (!event.startTime) return 'æœªè®¾ç½®';
  const start = new Date(event.startTime);
  const end = event.endTime ? new Date(event.endTime) : null;

  let result = start.toLocaleString('zh-CN', {
    month: 'short',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit',
  });

  if (end) {
    result += ' - ' + end.toLocaleTimeString('zh-CN', {
      hour: '2-digit',
      minute: '2-digit',
    });
  }

  return result;
}

// ç¡®è®¤åˆ›å»º
function confirmCreate() {
  // è§£æå‚ä¸äºº
  if (attendeesText.value) {
    editableEvent.value.attendees = attendeesText.value
      .split(/[,ï¼Œã€]/)
      .map(s => s.trim())
      .filter(s => s);
  }

  emit('confirm', editableEvent.value);
}

// å–æ¶ˆ
function cancel() {
  emit('cancel');
}
</script>

<style scoped>
.event-confirm-card {
  background: var(--bg-primary);
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border: 1px solid var(--border-color);
  max-width: 400px;
  margin: 16px 0;
}

.card-header {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 16px;
  border-bottom: 1px solid var(--border-color);
}

.card-icon {
  font-size: 20px;
}

.card-title {
  flex: 1;
  font-weight: 600;
  color: var(--text-primary);
}

.confidence-badge {
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 12px;
  font-weight: 500;
}

.confidence-badge.high {
  background: #dcfce7;
  color: #166534;
}

.confidence-badge.medium {
  background: #fef3c7;
  color: #92400e;
}

.confidence-badge.low {
  background: #fee2e2;
  color: #991b1b;
}

.card-body {
  padding: 16px;
}

.field-group {
  margin-bottom: 12px;
}

.field-label {
  display: block;
  font-size: 12px;
  color: var(--text-secondary);
  margin-bottom: 4px;
}

.field-value {
  display: flex;
  align-items: center;
  gap: 8px;
}

.field-input,
.field-select {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid var(--border-color);
  border-radius: 6px;
  font-size: 14px;
  background: var(--bg-secondary);
}

.time-display {
  flex: 1;
  padding: 8px 0;
  font-size: 14px;
  color: var(--text-primary);
}

.edit-btn {
  padding: 4px 8px;
  font-size: 12px;
  color: var(--primary-color);
  background: transparent;
  border: none;
  cursor: pointer;
}

.missing-info {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 12px;
  background: #fef3c7;
  border-radius: 6px;
  margin-top: 12px;
  font-size: 13px;
  color: #92400e;
}

.card-footer {
  display: flex;
  gap: 8px;
  padding: 16px;
  border-top: 1px solid var(--border-color);
}

.btn-confirm,
.btn-cancel {
  flex: 1;
  padding: 10px 16px;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  cursor: pointer;
  border: none;
}

.btn-confirm {
  background: var(--primary-color);
  color: white;
}

.btn-confirm:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-cancel {
  background: var(--bg-secondary);
  color: var(--text-primary);
  border: 1px solid var(--border-color);
}
</style>
```

---

## 4. é›†æˆæ–¹æ¡ˆ

### 4.1 ä¸AIåŠ©æ‰‹é›†æˆ

ä¿®æ”¹ `AIAssistant.vue`ï¼Œåœ¨æ¶ˆæ¯å¤„ç†æµç¨‹ä¸­å¢åŠ æ„å›¾è¯†åˆ«åˆ†æ”¯ï¼š

```javascript
// åœ¨ sendMessage æ–¹æ³•ä¸­
const sendMessage = async () => {
  if (!userInput.value.trim() || isTyping.value) return;

  const message = userInput.value.trim();
  userInput.value = '';

  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  chatStore.addUserMessage(message);

  // è®¾ç½®AIæ­£åœ¨è¾“å…¥çŠ¶æ€
  isTyping.value = true;

  try {
    // 1. å…ˆè¿›è¡Œæ„å›¾è¯†åˆ«
    const parseResult = await naturalLanguageService.parse(message, {
      currentTime: new Date(),
    });

    // 2. å¦‚æœæ˜¯åˆ›å»ºæ—¥ç¨‹æ„å›¾ï¼Œæ˜¾ç¤ºç¡®è®¤å¡ç‰‡
    if (parseResult.intent === 'create_event' && parseResult.confidence > 0.5) {
      // æ˜¾ç¤ºç¡®è®¤å¡ç‰‡ï¼Œç­‰å¾…ç”¨æˆ·ç¡®è®¤
      pendingEvent.value = parseResult;
      showEventConfirmCard.value = true;
      isTyping.value = false;
      return;
    }

    // 3. å¦åˆ™ï¼Œæ­£å¸¸èŠå¤©æµç¨‹
    const result = await chatService.sendMessage(message, {
      model: selectedModel.value,
      stream: false,
    });

    // ... åŸæœ‰é€»è¾‘

  } catch (error) {
    // ... é”™è¯¯å¤„ç†
  }
};
```

### 4.2 ä¸æ—¥å†æ¨¡å—é›†æˆ

åœ¨ç¡®è®¤åˆ›å»ºæ—¶è°ƒç”¨äº‹ä»¶å­˜å‚¨ï¼š

```javascript
// ç¡®è®¤åˆ›å»ºäº‹ä»¶
const confirmCreateEvent = async (eventData) => {
  try {
    const eventsStore = useEventsStore();

    // æ„å»ºäº‹ä»¶å¯¹è±¡
    const newEvent = {
      title: eventData.title,
      startDate: eventData.startTime,
      endDate: eventData.endTime,
      location: eventData.location,
      attendees: eventData.attendees,
      description: eventData.description,
      type: 'event',
      priority: 'medium',
    };

    // æ·»åŠ åˆ°æ—¥å†
    eventsStore.addEvent(newEvent);

    // æ˜¾ç¤ºæˆåŠŸæç¤º
    showSuccessToast('äº‹ä»¶åˆ›å»ºæˆåŠŸï¼');

    // å…³é—­ç¡®è®¤å¡ç‰‡
    showEventConfirmCard.value = false;
    pendingEvent.value = null;

    // æ·»åŠ AIå›å¤
    chatStore.addAssistantMessage(
      `âœ… å·²ä¸ºæ‚¨åˆ›å»ºäº‹ä»¶ï¼š"${eventData.title}"\n` +
      `ğŸ“… æ—¶é—´ï¼š${formatTime(eventData.startTime)}\n` +
      (eventData.location ? `ğŸ“ åœ°ç‚¹ï¼š${eventData.location}\n` : '')
    );

  } catch (error) {
    showErrorToast('äº‹ä»¶åˆ›å»ºå¤±è´¥ï¼š' + error.message);
  }
};
```

---

## 5. æµ‹è¯•ç­–ç•¥

### 5.1 å•å…ƒæµ‹è¯•

```javascript
// NaturalLanguageService.test.js
describe('NaturalLanguageService', () => {
  let service;

  beforeEach(() => {
    service = new NaturalLanguageService();
  });

  describe('æ„å›¾è¯†åˆ«', () => {
    test('è¯†åˆ«åˆ›å»ºæ—¥ç¨‹æ„å›¾', async () => {
      const result = await service.parse('æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š');
      expect(result.intent).toBe('create_event');
    });

    test('è¯†åˆ«æŸ¥è¯¢æ„å›¾', async () => {
      const result = await service.parse('æ˜å¤©æœ‰ä»€ä¹ˆå®‰æ’');
      expect(result.intent).toBe('query_schedule');
    });
  });

  describe('å®ä½“æå–', () => {
    test('æå–æ—¶é—´ä¿¡æ¯', async () => {
      const result = await service.parse('æ˜å¤©ä¸‹åˆ3ç‚¹å¼€ä¼š');
      expect(result.event.startTime).toBeDefined();
    });

    test('æå–åœ°ç‚¹ä¿¡æ¯', async () => {
      const result = await service.parse('åœ¨ä¼šè®®å®¤å¼€ä¼š');
      expect(result.event.location).toBe('ä¼šè®®å®¤');
    });
  });
});
```

### 5.2 é›†æˆæµ‹è¯•

```javascript
// integration.test.js
describe('è‡ªç„¶è¯­è¨€æ—¥ç¨‹åˆ›å»ºé›†æˆæµ‹è¯•', () => {
  test('å®Œæ•´æµç¨‹ï¼šè¾“å…¥ -> è§£æ -> ç¡®è®¤ -> åˆ›å»º', async () => {
    // 1. ç”¨æˆ·è¾“å…¥
    const input = 'æ˜å¤©ä¸‹åˆ3ç‚¹å’Œå¼ ä¸‰å¼€ä¼š';

    // 2. è§£æ
    const parseResult = await naturalLanguageService.parse(input);
    expect(parseResult.intent).toBe('create_event');

    // 3. ç¡®è®¤å¹¶åˆ›å»º
    const eventsStore = useEventsStore();
    const initialCount = eventsStore.events.length;

    await confirmCreateEvent(parseResult.event);

    // 4. éªŒè¯
    expect(eventsStore.events.length).toBe(initialCount + 1);
    expect(eventsStore.events[0].title).toBe('å¼€ä¼š');
  });
});
```

---

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 ç¼“å­˜ç­–ç•¥

```javascript
// è§£æç»“æœç¼“å­˜
const parseCache = new Map();
const CACHE_TTL = 5 * 60 * 1000; // 5åˆ†é’Ÿ

async function parseWithCache(input, context) {
  const cacheKey = `${input}_${context.currentTime?.getTime()}`;

  const cached = parseCache.get(cacheKey);
  if (cached && Date.now() - cached.timestamp < CACHE_TTL) {
    return cached.result;
  }

  const result = await naturalLanguageService.parse(input, context);
  parseCache.set(cacheKey, { result, timestamp: Date.now() });

  return result;
}
```

### 6.2 æ‡’åŠ è½½

```javascript
// æ‡’åŠ è½½è§£ææœåŠ¡
let naturalLanguageService = null;

async function getNaturalLanguageService() {
  if (!naturalLanguageService) {
    const { NaturalLanguageService } = await import(
      '@/services/naturalLanguageService.js'
    );
    naturalLanguageService = new NaturalLanguageService();
  }
  return naturalLanguageService;
}
```

---

## 7. é”™è¯¯å¤„ç†

### 7.1 é”™è¯¯ç±»å‹

```javascript
const ErrorTypes = {
  PARSE_ERROR: 'PARSE_ERROR',
  INTENT_NOT_RECOGNIZED: 'INTENT_NOT_RECOGNIZED',
  MISSING_REQUIRED_INFO: 'MISSING_REQUIRED_INFO',
  TIME_PARSE_ERROR: 'TIME_PARSE_ERROR',
  API_ERROR: 'API_ERROR',
};
```

### 7.2 é”™è¯¯å¤„ç†ç­–ç•¥

```javascript
async function handleParseError(error, userInput) {
  switch (error.type) {
    case ErrorTypes.INTENT_NOT_RECOGNIZED:
      // è½¬ä¸ºæ™®é€šèŠå¤©
      return await chatService.sendMessage(userInput);

    case ErrorTypes.MISSING_REQUIRED_INFO:
      // å¼•å¯¼ç”¨æˆ·è¡¥å……ä¿¡æ¯
      return {
        type: 'need_more_info',
        message: 'è¯·å‘Šè¯‰æˆ‘å…·ä½“çš„æ—¶é—´ï¼Œæ¯”å¦‚"æ˜å¤©ä¸‹åˆ3ç‚¹"',
      };

    case ErrorTypes.TIME_PARSE_ERROR:
      // æç¤ºæ—¶é—´æ ¼å¼é—®é¢˜
      return {
        type: 'time_parse_error',
        message: 'æŠ±æ­‰ï¼Œæˆ‘æ²¡æœ‰ç†è§£æ‚¨è¯´çš„æ—¶é—´ï¼Œè¯·ç”¨"æ˜å¤©ä¸‹åˆ3ç‚¹"è¿™æ ·çš„æ ¼å¼',
      };

    default:
      // é€šç”¨é”™è¯¯å¤„ç†
      console.error('è§£æé”™è¯¯:', error);
      return {
        type: 'error',
        message: 'æŠ±æ­‰ï¼Œå¤„ç†æ‚¨çš„è¯·æ±‚æ—¶å‡ºé”™äº†ï¼Œè¯·é‡è¯•',
      };
  }
}
```

---

## 8. éƒ¨ç½²æ–¹æ¡ˆ

### 8.1 æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ naturalLanguageService.js      # ä¸»æœåŠ¡
â”‚   â”œâ”€â”€ intentRecognizer.js            # æ„å›¾è¯†åˆ«
â”‚   â”œâ”€â”€ entityExtractor.js             # å®ä½“æå–
â”‚   â””â”€â”€ timeParser.js                  # æ—¶é—´è§£æ
â”œâ”€â”€ components/
â”‚   â””â”€â”€ EventConfirmCard.vue           # ç¡®è®¤å¡ç‰‡ç»„ä»¶
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ dateUtils.js                   # æ—¥æœŸå·¥å…·å‡½æ•°
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”‚   â”œâ”€â”€ naturalLanguageService.test.js
    â”‚   â”œâ”€â”€ intentRecognizer.test.js
    â”‚   â””â”€â”€ entityExtractor.test.js
    â””â”€â”€ integration/
        â””â”€â”€ naturalLanguageFlow.test.js
```

### 8.2 éƒ¨ç½²æ­¥éª¤

1. **ä»£ç åˆå¹¶**
   ```bash
   git checkout -b feature/natural-language-schedule
   # å¼€å‘å®Œæˆå
   git add .
   git commit -m "feat: æ·»åŠ è‡ªç„¶è¯­è¨€æ—¥ç¨‹åˆ›å»ºåŠŸèƒ½"
   git push origin feature/natural-language-schedule
   ```

2. **æ„å»ºéªŒè¯**
   ```bash
   npm run build
   npm run test
   ```

3. **ç°åº¦å‘å¸ƒ**
   - å…ˆå‘å¸ƒåˆ°æµ‹è¯•ç¯å¢ƒéªŒè¯
   - å†å‘å¸ƒåˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆ10%æµé‡ï¼‰
   - ç›‘æ§24å°æ—¶åå…¨é‡å‘å¸ƒ

---

## 9. ç›‘æ§æ–¹æ¡ˆ

### 9.1 ç›‘æ§æŒ‡æ ‡

```javascript
// æ€§èƒ½ç›‘æ§
const metrics = {
  // è§£ææˆåŠŸç‡
  parseSuccessRate: 0,

  // å¹³å‡è§£ææ—¶é—´
  averageParseTime: 0,

  // æ„å›¾è¯†åˆ«å‡†ç¡®ç‡
  intentAccuracy: 0,

  // æ—¶é—´è§£æå‡†ç¡®ç‡
  timeParseAccuracy: 0,

  // ç”¨æˆ·ç¡®è®¤ç‡
  userConfirmRate: 0,
};
```

### 9.2 æ—¥å¿—è®°å½•

```javascript
function logParseResult(input, result) {
  console.log('[NLP]', {
    timestamp: new Date().toISOString(),
    input: input.substring(0, 100), // é™åˆ¶é•¿åº¦
    intent: result.intent,
    confidence: result.confidence,
    hasEvent: !!result.event,
    missingInfoCount: result.missingInfo?.length || 0,
  });
}
```

---

## 10. é™„å½•

### 10.1 å‚è€ƒæ–‡æ¡£
- [éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦](./éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦-è‡ªç„¶è¯­è¨€æ—¥ç¨‹åˆ›å»º.md)
- [ç³»ç»Ÿç°çŠ¶æ–‡æ¡£](./ç³»ç»Ÿç°çŠ¶æ–‡æ¡£.md)
- [åŠŸèƒ½å½±å“çŸ©é˜µ](./åŠŸèƒ½å½±å“çŸ©é˜µ.md)

### 10.2 å˜æ›´å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | ä½œè€… |
|------|------|----------|------|
| 1.0 | 2026-01-31 | åˆå§‹ç‰ˆæœ¬ | AIåŠ©æ‰‹ |

---

**æ–‡æ¡£å®¡æ‰¹**

| è§’è‰² | å§“å | ç­¾å­— | æ—¥æœŸ |
|------|------|------|------|
| äº§å“ç»ç† | | | |
| æŠ€æœ¯è´Ÿè´£äºº | | | |
| æµ‹è¯•è´Ÿè´£äºº | | | |

